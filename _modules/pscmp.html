<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pscmp &#8212; beat 1.0beta documentation</title>
    <link rel="stylesheet" href="../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="../_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    
      <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Slab">
    
    
    <script type="text/javascript" src="../_static/jquery.gifplayer.js"></script>
    <link rel="stylesheet" type="text/css" href="../_static/gifplayer.css">
    <!-- Piwik -->
    <script type="text/javascript">
      var _paq = _paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//pyrocko.org/pwk/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <noscript>
    <img src="https://pyrocko.org/pwk/piwik.php?idsite=1&rec=1" style="border:0" alt="" />
    </noscript>

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
        <ul>
          <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
          <li>
            <img src='https://pyrocko.org/_static/pyrocko.svg' class='pyrocko-button' onclick="window.location = 'https://pyrocko.org';">
          </li>
           &#187;
          <li>
              <a href="../index.html">beat 1.0beta documentation</a> &#187;
          </li>
            <li><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
        </ul>
    </div>
    

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pscmp</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module got merged with the psgrn module and is now part of the pyrocko</span>
<span class="sd">library and may be removed from the beat repository in the future.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># coding=utf-8</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">num</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">from</span> <span class="nn">beat.utility</span> <span class="k">import</span> <span class="n">adjust_fault_reference</span>

<span class="kn">from</span> <span class="nn">tempfile</span> <span class="k">import</span> <span class="n">mkdtemp</span><span class="p">,</span> <span class="n">TemporaryFile</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="k">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="k">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">pjoin</span>

<span class="kn">from</span> <span class="nn">pyrocko.guts</span> <span class="k">import</span> <span class="n">Float</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Object</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">pyrocko</span> <span class="k">import</span> <span class="n">gf</span>
<span class="kn">from</span> <span class="nn">pyrocko.orthodrome</span> <span class="k">import</span> <span class="n">ne_to_latlon</span>

<span class="n">km</span> <span class="o">=</span> <span class="mf">1000.</span>

<span class="n">guts_prefix</span> <span class="o">=</span> <span class="s1">&#39;pf&#39;</span>

<span class="n">Timing</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Timing</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;pscmp&#39;</span><span class="p">)</span>

<span class="c1"># how to call the programs</span>
<span class="n">program_bins</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;pscmp.2008a&#39;</span><span class="p">:</span> <span class="s1">&#39;fomosto_pscmp2008a&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">psgrn_displ_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;uz&#39;</span><span class="p">,</span> <span class="s1">&#39;ur&#39;</span><span class="p">,</span> <span class="s1">&#39;ut&#39;</span><span class="p">)</span>
<span class="n">psgrn_stress_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;szz&#39;</span><span class="p">,</span> <span class="s1">&#39;srr&#39;</span><span class="p">,</span> <span class="s1">&#39;stt&#39;</span><span class="p">,</span> <span class="s1">&#39;szr&#39;</span><span class="p">,</span> <span class="s1">&#39;srt&#39;</span><span class="p">,</span> <span class="s1">&#39;stz&#39;</span><span class="p">)</span>
<span class="n">psgrn_tilt_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">,</span> <span class="s1">&#39;tt&#39;</span><span class="p">,</span> <span class="s1">&#39;rot&#39;</span><span class="p">)</span>
<span class="n">psgrn_gravity_names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;gd&#39;</span><span class="p">,</span> <span class="s1">&#39;gr&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">str_float_vals</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">str_int_vals</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">str_str_vals</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">dsin</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">dcos</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span><span class="p">)</span>


<div class="viewcode-block" id="distributed_fault_patches_to_config"><a class="viewcode-back" href="../api.html#pscmp.distributed_fault_patches_to_config">[docs]</a><span class="k">def</span> <span class="nf">distributed_fault_patches_to_config</span><span class="p">(</span><span class="n">patches</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Input: List of PsCmpRectangularSource(s)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">srows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">patch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">patches</span><span class="p">):</span>
            <span class="n">srows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">patch</span><span class="o">.</span><span class="n">string_for_config</span><span class="p">()))</span>

    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">srows</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">srows</span><span class="p">)</span></div>


<div class="viewcode-block" id="PsCmpObservation"><a class="viewcode-back" href="../api.html#pscmp.PsCmpObservation">[docs]</a><span class="k">class</span> <span class="nc">PsCmpObservation</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="PsCmpScatter"><a class="viewcode-back" href="../api.html#pscmp.PsCmpScatter">[docs]</a><span class="k">class</span> <span class="nc">PsCmpScatter</span><span class="p">(</span><span class="n">PsCmpObservation</span><span class="p">):</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mf">10.4</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">])</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mf">12.3</span><span class="p">,</span> <span class="mf">13.4</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">string_for_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">srows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lons</span><span class="p">):</span>
            <span class="n">srows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">%15f</span><span class="s1">, </span><span class="si">%15f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sw</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="s1">&#39; </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">srows</span><span class="p">)),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">srows</span><span class="p">)</span></div>


<div class="viewcode-block" id="PsCmpProfile"><a class="viewcode-back" href="../api.html#pscmp.PsCmpProfile">[docs]</a><span class="k">class</span> <span class="nc">PsCmpProfile</span><span class="p">(</span><span class="n">PsCmpObservation</span><span class="p">):</span>
    <span class="n">n_steps</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">start_distance</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;minimum distance from source [m]&#39;</span><span class="p">)</span>
    <span class="n">end_distance</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">100.</span> <span class="o">*</span> <span class="n">km</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;minimum distance from source [m]&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">string_for_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sw</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># convert to km as pscmp takes [km]</span>
        <span class="n">str_start_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_distance</span> <span class="o">/</span> <span class="n">km</span>
        <span class="n">str_end_distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_distance</span> <span class="o">/</span> <span class="n">km</span>
        <span class="k">return</span> <span class="s1">&#39; </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span><span class="p">),</span> \
            <span class="s1">&#39; ( </span><span class="si">%15f</span><span class="s1">, </span><span class="si">%15f</span><span class="s1"> )&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">str_start_distance</span><span class="p">,</span> <span class="n">str_end_distance</span><span class="p">)</span></div>


<div class="viewcode-block" id="PsCmpArray"><a class="viewcode-back" href="../api.html#pscmp.PsCmpArray">[docs]</a><span class="k">class</span> <span class="nc">PsCmpArray</span><span class="p">(</span><span class="n">PsCmpObservation</span><span class="p">):</span>
    <span class="n">n_steps_x</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">n_steps_y</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">start_distance_x</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;minimum distance in x-direction (E) from source [m]&#39;</span><span class="p">)</span>
    <span class="n">end_distance_x</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">100.</span> <span class="o">*</span> <span class="n">km</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;maximum distance in x-direction (E) from source [m]&#39;</span><span class="p">)</span>
    <span class="n">start_distance_y</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;minimum distance in y-direction (N) from source [m]&#39;</span><span class="p">)</span>
    <span class="n">end_distance_y</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">100.</span> <span class="o">*</span> <span class="n">km</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;minimum distance in y-direction (N) from source [m]&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">string_for_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sw</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="c1"># convert to km as pscmp takes [km]</span>
        <span class="n">str_start_distance_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_distance_x</span> <span class="o">/</span> <span class="n">km</span>
        <span class="n">str_end_distance_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_distance_x</span> <span class="o">/</span> <span class="n">km</span>
        <span class="n">str_start_distance_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_distance_y</span> <span class="o">/</span> <span class="n">km</span>
        <span class="n">str_end_distance_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_distance_y</span> <span class="o">/</span> <span class="n">km</span>

        <span class="k">return</span> <span class="s1">&#39; </span><span class="si">%i</span><span class="s1"> </span><span class="si">%15f</span><span class="s1"> </span><span class="si">%15f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_steps_x</span><span class="p">,</span> <span class="n">str_start_distance_x</span><span class="p">,</span> <span class="n">str_end_distance_x</span><span class="p">),</span> \
               <span class="s1">&#39; </span><span class="si">%i</span><span class="s1"> </span><span class="si">%15f</span><span class="s1"> </span><span class="si">%15f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_steps_y</span><span class="p">,</span> <span class="n">str_start_distance_y</span><span class="p">,</span> <span class="n">str_end_distance_y</span><span class="p">)</span></div>


<div class="viewcode-block" id="PsCmpRectangularSource"><a class="viewcode-back" href="../api.html#pscmp.PsCmpRectangularSource">[docs]</a><span class="k">class</span> <span class="nc">PsCmpRectangularSource</span><span class="p">(</span><span class="n">gf</span><span class="o">.</span><span class="n">Location</span><span class="p">,</span> <span class="n">gf</span><span class="o">.</span><span class="n">seismosizer</span><span class="o">.</span><span class="n">Cloneable</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Input parameters have to be in:</span>
<span class="sd">    [deg] for reference point (lat, lon) and angles (rake, strike, dip)</span>
<span class="sd">    [m] shifting with respect to reference position</span>
<span class="sd">    [m] for fault dimensions and source depth. The default shift of the</span>
<span class="sd">    origin (pos_s, pos_d) with respect to the reference coordinates</span>
<span class="sd">    (lat, lon) is zero.</span>
<span class="sd">    The depth parameter can be either top edge or center can be modified</span>
<span class="sd">    by using the update method (use flag: top_depth=(True)/False).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">6.0</span> <span class="o">*</span> <span class="n">km</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">5.0</span> <span class="o">*</span> <span class="n">km</span><span class="p">)</span>
    <span class="n">strike</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">dip</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">90.0</span><span class="p">)</span>
    <span class="n">rake</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">torigin</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">slip</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">pos_s</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">pos_d</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">opening</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">outline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="o">=</span><span class="s1">&#39;xyz&#39;</span><span class="p">):</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">seismosizer</span><span class="o">.</span><span class="n">outline_rect_source</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">)</span>

        <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">north_shift</span>
        <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">east_shift</span>
        <span class="n">points</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>
        <span class="k">if</span> <span class="n">cs</span> <span class="o">==</span> <span class="s1">&#39;xyz&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">points</span>
        <span class="k">elif</span> <span class="n">cs</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">points</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">cs</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;latlon&#39;</span><span class="p">,</span> <span class="s1">&#39;lonlat&#39;</span><span class="p">):</span>
            <span class="n">latlon</span> <span class="o">=</span> <span class="n">ne_to_latlon</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">latlon</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">latlon</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="k">if</span> <span class="n">cs</span> <span class="o">==</span> <span class="s1">&#39;latlon&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">latlon</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">latlon</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="PsCmpRectangularSource.update"><a class="viewcode-back" href="../api.html#pscmp.PsCmpRectangularSource.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top_depth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Change some of the source models parameters.</span>
<span class="sd">            Input update depth per default: Top depth!</span>

<span class="sd">        Example::</span>

<span class="sd">          &gt;&gt;&gt; from pyrocko import gf</span>
<span class="sd">          &gt;&gt;&gt; s = gf.DCSource()</span>
<span class="sd">          &gt;&gt;&gt; s.update(strike=66., dip=33.)</span>
<span class="sd">          &gt;&gt;&gt; print s</span>
<span class="sd">          --- !pf.DCSource</span>
<span class="sd">          depth: 0.0</span>
<span class="sd">          time: 1970-01-01 00:00:00</span>
<span class="sd">          magnitude: 6.0</span>
<span class="sd">          strike: 66.0</span>
<span class="sd">          dip: 33.0</span>
<span class="sd">          rake: 0.0</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">if</span> <span class="n">top_depth</span><span class="p">:</span>
            <span class="n">adjust_fault_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_depth</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dip_slip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slip</span> <span class="o">*</span> <span class="n">dsin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rake</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">strike_slip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slip</span> <span class="o">*</span> <span class="n">dcos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rake</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">string_for_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_s</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_d</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos_s</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pos_d</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="n">tempd</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="n">tempd</span><span class="p">[</span><span class="s1">&#39;dip_slip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dip_slip</span>
        <span class="n">tempd</span><span class="p">[</span><span class="s1">&#39;strike_slip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strike_slip</span>
        <span class="n">tempd</span><span class="p">[</span><span class="s1">&#39;effective_lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">effective_lat</span>
        <span class="n">tempd</span><span class="p">[</span><span class="s1">&#39;effective_lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">effective_lon</span>
        <span class="n">tempd</span><span class="p">[</span><span class="s1">&#39;depth&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">km</span>
        <span class="n">tempd</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">km</span>
        <span class="n">tempd</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">km</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%(effective_lat)15f</span><span class="s1"> </span><span class="si">%(effective_lon)15f</span><span class="s1"> </span><span class="si">%(depth)15f</span><span class="s1">&#39;</span> \
               <span class="s1">&#39;</span><span class="si">%(length)15f</span><span class="s1"> </span><span class="si">%(width)15f</span><span class="s1"> </span><span class="si">%(strike)15f</span><span class="s1">&#39;</span> \
               <span class="s1">&#39;</span><span class="si">%(dip)15f</span><span class="s1"> 1 1 </span><span class="si">%(torigin)15f</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> </span><span class="si">%(pos_s)15f</span><span class="s1"> </span><span class="si">%(pos_d)15f</span><span class="s1"> &#39;</span> \
               <span class="s1">&#39;</span><span class="si">%(strike_slip)15f</span><span class="s1"> </span><span class="si">%(dip_slip)15f</span><span class="s1"> </span><span class="si">%(opening)15f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tempd</span></div>


<div class="viewcode-block" id="PsCmpCoulombStress"><a class="viewcode-back" href="../api.html#pscmp.PsCmpCoulombStress">[docs]</a><span class="k">class</span> <span class="nc">PsCmpCoulombStress</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="PsCmpCoulombStressMasterFault"><a class="viewcode-back" href="../api.html#pscmp.PsCmpCoulombStressMasterFault">[docs]</a><span class="k">class</span> <span class="nc">PsCmpCoulombStressMasterFault</span><span class="p">(</span><span class="n">PsCmpCoulombStress</span><span class="p">):</span>
    <span class="n">friction</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">skempton_ratio</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">master_fault_strike</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">300.</span><span class="p">)</span>
    <span class="n">master_fault_dip</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">15.</span><span class="p">)</span>
    <span class="n">master_fault_rake</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">90.</span><span class="p">)</span>
    <span class="n">sigma1</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">1.e6</span><span class="p">)</span>
    <span class="n">sigma2</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=-</span><span class="mf">1.e6</span><span class="p">)</span>
    <span class="n">sigma3</span> <span class="o">=</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">string_for_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%(friction)15e</span><span class="s1"> </span><span class="si">%(skempton_ratio)15e</span><span class="s1"> </span><span class="si">%(master_fault_strike)15f</span><span class="s1">&#39;</span> \
               <span class="s1">&#39;</span><span class="si">%(master_fault_dip)15f</span><span class="s1"> </span><span class="si">%(master_fault_rake)15f</span><span class="s1">&#39;</span> \
               <span class="s1">&#39;</span><span class="si">%(sigma1)15e</span><span class="s1"> </span><span class="si">%(sigma2)15e</span><span class="s1"> </span><span class="si">%(sigma3)15e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span></div>


<div class="viewcode-block" id="PsCmpConfig"><a class="viewcode-back" href="../api.html#pscmp.PsCmpConfig">[docs]</a><span class="k">class</span> <span class="nc">PsCmpConfig</span><span class="p">(</span><span class="n">Object</span><span class="p">):</span>

    <span class="n">pscmp_version</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;2008a&#39;</span><span class="p">)</span>
    <span class="c1"># scatter, profile or array</span>
    <span class="n">observation</span> <span class="o">=</span> <span class="n">PsCmpObservation</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">PsCmpScatter</span><span class="o">.</span><span class="n">D</span><span class="p">())</span>

    <span class="n">pscmp_outdir</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">)</span>
    <span class="n">psgrn_outdir</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;./psgrn_functions/&#39;</span><span class="p">)</span>

    <span class="n">los_vector</span> <span class="o">=</span> <span class="n">Tuple</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">times_snapshots</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">rectangular_source_patches</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="n">PsCmpRectangularSource</span><span class="o">.</span><span class="n">D</span><span class="p">()])</span></div>


<div class="viewcode-block" id="PsCmpConfigFull"><a class="viewcode-back" href="../api.html#pscmp.PsCmpConfigFull">[docs]</a><span class="k">class</span> <span class="nc">PsCmpConfigFull</span><span class="p">(</span><span class="n">PsCmpConfig</span><span class="p">):</span>

    <span class="n">sw_los_displacement</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sw_coulomb_stress</span> <span class="o">=</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">coulomb_master_field</span> <span class="o">=</span> <span class="n">PsCmpCoulombStress</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="n">PsCmpCoulombStressMasterFault</span><span class="o">.</span><span class="n">D</span><span class="p">())</span>

    <span class="n">displ_sw_output_types</span> <span class="o">=</span> <span class="n">Tuple</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">stress_sw_output_types</span> <span class="o">=</span> <span class="n">Tuple</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">tilt_sw_output_types</span> <span class="o">=</span> <span class="n">Tuple</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">gravity_sw_output_types</span> <span class="o">=</span> <span class="n">Tuple</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Int</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="n">displ_filenames</span> <span class="o">=</span> <span class="n">Tuple</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="n">psgrn_displ_names</span><span class="p">)</span>
    <span class="n">stress_filenames</span> <span class="o">=</span> <span class="n">Tuple</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="n">psgrn_stress_names</span><span class="p">)</span>
    <span class="n">tilt_filenames</span> <span class="o">=</span> <span class="n">Tuple</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="n">psgrn_tilt_names</span><span class="p">)</span>
    <span class="n">gravity_filenames</span> <span class="o">=</span> <span class="n">Tuple</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="n">psgrn_gravity_names</span><span class="p">)</span>

    <span class="n">snapshot_basefilename</span> <span class="o">=</span> <span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;snapshot&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">example</span><span class="p">():</span>
        <span class="n">conf</span> <span class="o">=</span> <span class="n">PsCmpConfigFull</span><span class="p">()</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">psgrn_outdir</span> <span class="o">=</span> <span class="s1">&#39;TEST_psgrn_functions/&#39;</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">pscmp_outdir</span> <span class="o">=</span> <span class="s1">&#39;TEST_pscmp_output/&#39;</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">rectangular_source_patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">PsCmpRectangularSource</span><span class="p">(</span>
                                <span class="n">lat</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">slip</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span>
                                <span class="n">width</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span>
                                <span class="n">strike</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">dip</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">rake</span><span class="o">=-</span><span class="mi">90</span><span class="p">)]</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">observation</span> <span class="o">=</span> <span class="n">PsCmpArray</span><span class="p">(</span>
                <span class="n">start_distance_x</span><span class="o">=</span><span class="mf">9.5</span><span class="p">,</span> <span class="n">end_distance_x</span><span class="o">=</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">n_steps_x</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
                <span class="n">start_distance_y</span><span class="o">=</span><span class="mf">9.5</span><span class="p">,</span> <span class="n">end_distance_y</span><span class="o">=</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">n_steps_y</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
        <span class="n">conf</span><span class="o">.</span><span class="n">times_snapshots</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">conf</span>

    <span class="k">def</span> <span class="nf">get_output_filenames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rundir</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pjoin</span><span class="p">(</span><span class="n">rundir</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_basefilename</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">times_snapshots</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">string_for_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">patches_str</span><span class="p">,</span> <span class="n">n_patches</span> <span class="o">=</span> <span class="n">distributed_fault_patches_to_config</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rectangular_source_patches</span><span class="p">)</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;patches_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">patches_str</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;n_patches&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_patches</span>

        <span class="n">str_npoints</span><span class="p">,</span> <span class="n">str_observation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">string_for_config</span><span class="p">()</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_npoints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_npoints</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_observation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_observation</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;sw_observation_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">sw</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">times_snapshots</span><span class="p">:</span>
            <span class="n">str_times_dummy</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">times_snapshots</span><span class="p">):</span>
                <span class="n">str_times_dummy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%f</span><span class="s2">  &#39;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%i</span><span class="s2">.txt&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">snapshot_basefilename</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

            <span class="n">str_times_dummy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_times_snapshots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_times_dummy</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;n_snapshots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_times_dummy</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_times_snapshots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;# &#39;</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;n_snapshots&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw_los_displacement</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_los_vector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_float_vals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">los_vector</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_los_vector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw_coulomb_stress</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_coulomb_master_field&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">coulomb_master_field</span><span class="o">.</span><span class="n">string_for_config</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_coulomb_master_field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_psgrn_outdir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;../../</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">psgrn_outdir</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_pscmp_outdir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="s1">&#39;./&#39;</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_displ_filenames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_str_vals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displ_filenames</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_stress_filenames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_str_vals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stress_filenames</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_tilt_filenames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_str_vals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tilt_filenames</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_gravity_filenames&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_str_vals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gravity_filenames</span><span class="p">)</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_displ_sw_output_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_int_vals</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displ_sw_output_types</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_stress_sw_output_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_int_vals</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stress_sw_output_types</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_tilt_sw_output_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_int_vals</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tilt_sw_output_types</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;str_gravity_sw_output_types&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">str_int_vals</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gravity_sw_output_types</span><span class="p">)</span>

        <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;# autogenerated PSCMP input by pscmp.py</span>
<span class="s1">#===============================================================================</span>
<span class="s1"># This is input file of FORTRAN77 program &quot;pscmp08&quot; for modeling post-seismic</span>
<span class="s1"># deformation induced by earthquakes in multi-layered viscoelastic media using</span>
<span class="s1"># the Green&#39;s function approach. The earthquke source is represented by an</span>
<span class="s1"># arbitrary number of rectangular dislocation planes. For more details, please</span>
<span class="s1"># read the accompanying READ.ME file.</span>
<span class="s1">#</span>
<span class="s1"># written by Rongjiang Wang</span>
<span class="s1"># GeoForschungsZentrum Potsdam</span>
<span class="s1"># e-mail: wang@gfz-potsdam.de</span>
<span class="s1"># phone +49 331 2881209</span>
<span class="s1"># fax +49 331 2881204</span>
<span class="s1">#</span>
<span class="s1"># Last modified: Potsdam, July, 2008</span>
<span class="s1">#</span>
<span class="s1"># References:</span>
<span class="s1">#</span>
<span class="s1"># (1) Wang, R., F. Lorenzo-Martín and F. Roth (2003), Computation of deformation</span>
<span class="s1">#     induced by earthquakes in a multi-layered elastic crust - FORTRAN programs</span>
<span class="s1">#     EDGRN/EDCMP, Computer and Geosciences, 29(2), 195-207.</span>
<span class="s1"># (2) Wang, R., F. Lorenzo-Martin and F. Roth (2006), PSGRN/PSCMP - a new code for</span>
<span class="s1">#     calculating co- and post-seismic deformation, geoid and gravity changes</span>
<span class="s1">#     based on the viscoelastic-gravitational dislocation theory, Computers and</span>
<span class="s1">#     Geosciences, 32, 527-541. DOI:10.1016/j.cageo.2005.08.006.</span>
<span class="s1"># (3) Wang, R. (2005), The dislocation theory: a consistent way for including the</span>
<span class="s1">#     gravity effect in (visco)elastic plane-earth models, Geophysical Journal</span>
<span class="s1">#     International, 161, 191-196.</span>
<span class="s1">#</span>
<span class="s1">#################################################################</span>
<span class="s1">##                                                             ##</span>
<span class="s1">## Green&#39;s functions should have been prepared with the        ##</span>
<span class="s1">## program &quot;psgrn08&quot; before the program &quot;pscmp08&quot; is started.  ##</span>
<span class="s1">##                                                             ##</span>
<span class="s1">## For local Cartesian coordinate system, the Aki&#39;s convention ##</span>
<span class="s1">## is used, that is, x is northward, y is eastward, and z is   ##</span>
<span class="s1">## downward.                                                   ##</span>
<span class="s1">##                                                             ##</span>
<span class="s1">## If not specified otherwise, SI Unit System is used overall! ##</span>
<span class="s1">##                                                             ##</span>
<span class="s1">#################################################################</span>
<span class="s1">#===============================================================================</span>
<span class="s1"># OBSERVATION ARRAY</span>
<span class="s1"># =================</span>
<span class="s1"># 1. selection for irregular observation positions (= 0) or a 1D observation</span>
<span class="s1">#    profile (= 1) or a rectangular 2D observation array (= 2): iposrec</span>
<span class="s1">#</span>
<span class="s1">#    IF (iposrec = 0 for irregular observation positions) THEN</span>
<span class="s1">#</span>
<span class="s1"># 2. number of positions: nrec</span>
<span class="s1">#</span>
<span class="s1"># 3. coordinates of the observations: (lat(i),lon(i)), i=1,nrec</span>
<span class="s1">#</span>
<span class="s1">#    ELSE IF (iposrec = 1 for regular 1D observation array) THEN</span>
<span class="s1">#</span>
<span class="s1"># 2. number of position samples of the profile: nrec</span>
<span class="s1">#</span>
<span class="s1"># 3. the start and end positions: (lat1,lon1), (lat2,lon2)</span>
<span class="s1">#</span>
<span class="s1">#    ELSE IF (iposrec = 2 for rectanglular 2D observation array) THEN</span>
<span class="s1">#</span>
<span class="s1"># 2. number of x samples, start and end values: nxrec, xrec1, xrec2</span>
<span class="s1">#</span>
<span class="s1"># 3. number of y samples, start and end values: nyrec, yrec1, yrec2</span>
<span class="s1">#</span>
<span class="s1">#    sequence of the positions in output data: lat(1),lon(1); ...; lat(nx),lon(1);</span>
<span class="s1">#    lat(1),lon(2); ...; lat(nx),lon(2); ...; lat(1),lon(ny); ...; lat(nx),lon(ny).</span>
<span class="s1">#</span>
<span class="s1">#    Note that the total number of observation positions (nrec or nxrec*nyrec)</span>
<span class="s1">#    should be &lt;= NRECMAX (see pecglob.h)!</span>
<span class="s1">#===============================================================================</span>
<span class="s1"> </span><span class="si">%(sw_observation_type)i</span><span class="s1"></span>
<span class="si">%(str_npoints)s</span><span class="s1"></span>
<span class="si">%(str_observation)s</span><span class="s1"></span>
<span class="s1">#===============================================================================</span>
<span class="s1"># OUTPUTS</span>
<span class="s1"># =======</span>
<span class="s1">#</span>
<span class="s1"># 1. select output for los displacement (only for snapshots, see below), x, y,</span>
<span class="s1">#    and z-cosines to the INSAR orbit: insar (1/0 = yes/no), xlos, ylos, zlos</span>
<span class="s1">#</span>
<span class="s1">#    if this option is selected (insar = 1), the snapshots will include additional</span>
<span class="s1">#    data:</span>
<span class="s1">#    LOS_Dsp = los displacement to the given satellite orbit.</span>
<span class="s1">#</span>
<span class="s1"># 2. select output for Coulomb stress changes (only for snapshots, see below):</span>
<span class="s1">#    icmb (1/0 = yes/no), friction, Skempton ratio, strike, dip, and rake angles</span>
<span class="s1">#    [deg] describing the uniform regional master fault mechanism, the uniform</span>
<span class="s1">#    regional principal stresses: sigma1, sigma2 and sigma3 [Pa] in arbitrary</span>
<span class="s1">#    order (the orietation of the pre-stress field will be derived by assuming</span>
<span class="s1">#    that the master fault is optimally oriented according to Coulomb failure</span>
<span class="s1">#    criterion)</span>
<span class="s1">#</span>
<span class="s1">#    if this option is selected (icmb = 1), the snapshots will include additional</span>
<span class="s1">#    data:</span>
<span class="s1">#    CMB_Fix, Sig_Fix = Coulomb and normal stress changes on master fault;</span>
<span class="s1">#    CMB_Op1/2, Sig_Op1/2 = Coulomb and normal stress changes on the two optimally</span>
<span class="s1">#                       oriented faults;</span>
<span class="s1">#    Str_Op1/2, Dip_Op1/2, Slp_Op1/2 = strike, dip and rake angles of the two</span>
<span class="s1">#                       optimally oriented faults.</span>
<span class="s1">#</span>
<span class="s1">#    Note: the 1. optimally orieted fault is the one closest to the master fault.</span>
<span class="s1">#</span>
<span class="s1"># 3. output directory in char format: outdir</span>
<span class="s1">#</span>
<span class="s1"># 4. select outputs for displacement components (1/0 = yes/no): itout(i), i=1-3</span>
<span class="s1">#</span>
<span class="s1"># 5. the file names in char format for the x, y, and z components:</span>
<span class="s1">#    toutfile(i), i=1-3</span>
<span class="s1">#</span>
<span class="s1"># 6. select outputs for stress components (1/0 = yes/no): itout(i), i=4-9</span>
<span class="s1">#</span>
<span class="s1"># 7. the file names in char format for the xx, yy, zz, xy, yz, and zx components:</span>
<span class="s1">#    toutfile(i), i=4-9</span>
<span class="s1">#</span>
<span class="s1"># 8. select outputs for vertical NS and EW tilt components, block rotation, geoid</span>
<span class="s1">#    and gravity changes (1/0 = yes/no): itout(i), i=10-14</span>
<span class="s1">#</span>
<span class="s1"># 9. the file names in char format for the NS tilt (positive if borehole top</span>
<span class="s1">#    tilts to north), EW tilt (positive if borehole top tilts to east), block</span>
<span class="s1">#    rotation (clockwise positive), geoid and gravity changes: toutfile(i), i=10-14</span>
<span class="s1">#</span>
<span class="s1">#    Note that all above outputs are time series with the time window as same</span>
<span class="s1">#    as used for the Green&#39;s functions</span>
<span class="s1">#</span>
<span class="s1">#10. number of scenario outputs (&quot;snapshots&quot;: spatial distribution of all above</span>
<span class="s1">#    observables at given time points; &lt;= NSCENMAX (see pscglob.h): nsc</span>
<span class="s1">#</span>
<span class="s1">#11. the time [day], and file name (in char format) for the 1. snapshot;</span>
<span class="s1">#12. the time [day], and file name (in char format) for the 2. snapshot;</span>
<span class="s1">#13. ...</span>
<span class="s1">#</span>
<span class="s1">#    Note that all file or directory names should not be longer than 80</span>
<span class="s1">#    characters. Directories must be ended by / (unix) or \ (dos)!</span>
<span class="s1">#===============================================================================</span>
<span class="s1"> </span><span class="si">%(sw_los_displacement)i</span><span class="s1">    </span><span class="si">%(str_los_vector)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(sw_coulomb_stress)i</span><span class="s1">    </span><span class="si">%(str_coulomb_master_field)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(str_pscmp_outdir)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(str_displ_sw_output_types)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(str_displ_filenames)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(str_stress_sw_output_types)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(str_stress_filenames)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(str_tilt_sw_output_types)s</span><span class="s1">    </span><span class="si">%(str_gravity_sw_output_types)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(str_tilt_filenames)s</span><span class="s1"> </span><span class="si">%(str_gravity_filenames)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(n_snapshots)i</span><span class="s1"></span>
<span class="si">%(str_times_snapshots)s</span><span class="s1"></span>
<span class="s1">#===============================================================================</span>
<span class="s1">#</span>
<span class="s1"># GREEN&#39;S FUNCTION DATABASE</span>
<span class="s1"># =========================</span>
<span class="s1"># 1. directory where the Green&#39;s functions are stored: grndir</span>
<span class="s1">#</span>
<span class="s1"># 2. file names (without extensions!) for the 13 Green&#39;s functions:</span>
<span class="s1">#    3 displacement komponents (uz, ur, ut): green(i), i=1-3</span>
<span class="s1">#    6 stress components (szz, srr, stt, szr, srt, stz): green(i), i=4-9</span>
<span class="s1">#    radial and tangential components measured by a borehole tiltmeter,</span>
<span class="s1">#    rigid rotation around z-axis, geoid and gravity changes (tr, tt, rot, gd, gr):</span>
<span class="s1">#    green(i), i=10-14</span>
<span class="s1">#</span>
<span class="s1">#    Note that all file or directory names should not be longer than 80</span>
<span class="s1">#    characters. Directories must be ended by / (unix) or \ (dos)! The</span>
<span class="s1">#    extensions of the file names will be automatically considered. They</span>
<span class="s1">#    are &quot;.ep&quot;, &quot;.ss&quot;, &quot;.ds&quot; and &quot;.cl&quot; denoting the explosion (inflation)</span>
<span class="s1">#    strike-slip, the dip-slip and the compensated linear vector dipole</span>
<span class="s1">#    sources, respectively.</span>
<span class="s1">#</span>
<span class="s1">#===============================================================================</span>
<span class="s1"> </span><span class="si">%(str_psgrn_outdir)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(str_displ_filenames)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(str_stress_filenames)s</span><span class="s1"></span>
<span class="s1"> </span><span class="si">%(str_tilt_filenames)s</span><span class="s1">    </span><span class="si">%(str_gravity_filenames)s</span><span class="s1"></span>
<span class="s1">#===============================================================================</span>
<span class="s1"># RECTANGULAR SUBFAULTS</span>
<span class="s1"># =====================</span>
<span class="s1"># 1. number of subfaults (&lt;= NSMAX in pscglob.h): ns</span>
<span class="s1">#</span>
<span class="s1"># 2. parameters for the 1. rectangular subfault: geographic coordinates</span>
<span class="s1">#    (O_lat, O_lon) [deg] and O_depth [km] of the local reference point on</span>
<span class="s1">#    the present fault plane, length (along strike) [km] and width (along down</span>
<span class="s1">#    dip) [km], strike [deg], dip [deg], number of equi-size fault patches along</span>
<span class="s1">#    the strike (np_st) and along the dip (np_di) (total number of fault patches</span>
<span class="s1">#    = np_st x np_di), and the start time of the rupture; the following data</span>
<span class="s1">#    lines describe the slip distribution on the present sub-fault:</span>
<span class="s1">#</span>
<span class="s1">#    pos_s[km]  pos_d[km]  slip_strike[m]  slip_downdip[m]  opening[m]</span>
<span class="s1">#</span>
<span class="s1">#    where (pos_s,pos_d) defines the position of the center of each patch in</span>
<span class="s1">#    the local coordinate system with the origin at the reference point:</span>
<span class="s1">#    pos_s = distance along the length (positive in the strike direction)</span>
<span class="s1">#    pos_d = distance along the width (positive in the down-dip direction)</span>
<span class="s1">#</span>
<span class="s1">#</span>
<span class="s1"># 3. ... for the 2. subfault ...</span>
<span class="s1"># ...</span>
<span class="s1">#                   N</span>
<span class="s1">#                  /</span>
<span class="s1">#                 /| strike</span>
<span class="s1">#                +------------------------</span>
<span class="s1">#                |\        p .            \ W</span>
<span class="s1">#                :-\      i .              \ i</span>
<span class="s1">#                |  \    l .                \ d</span>
<span class="s1">#                :90 \  S .                  \ t</span>
<span class="s1">#                |-dip\  .                    \ h</span>
<span class="s1">#                :     \. | rake               \ </span>
<span class="s1">#                Z      -------------------------</span>
<span class="s1">#                              L e n g t h</span>
<span class="s1">#</span>
<span class="s1">#    Simulation of a Mogi source:</span>
<span class="s1">#    (1) Calculate deformation caused by three small openning plates (each</span>
<span class="s1">#        causes a third part of the volume of the point inflation) located</span>
<span class="s1">#        at the same depth as the Mogi source but oriented orthogonal to</span>
<span class="s1">#        each other.</span>
<span class="s1">#    (2) Multiply the results by 3(1-nu)/(1+nu), where nu is the Poisson</span>
<span class="s1">#        ratio at the source depth.</span>
<span class="s1">#    The multiplication factor is the ratio of the seismic moment (energy) of</span>
<span class="s1">#    the Mogi source to that of the plate openning with the same volume change.</span>
<span class="s1">#===============================================================================</span>
<span class="s1"># n_faults</span>
<span class="s1">#-------------------------------------------------------------------------------</span>
<span class="s1"> </span><span class="si">%(n_patches)i</span><span class="s1"></span>
<span class="s1">#-------------------------------------------------------------------------------</span>
<span class="s1"># n   O_lat   O_lon   O_depth length  width strike dip   np_st np_di start_time</span>
<span class="s1"># [-] [deg]   [deg]   [km]    [km]     [km] [deg]  [deg] [-]   [-]   [day]</span>
<span class="s1">#     pos_s   pos_d   slp_stk slp_ddip open</span>
<span class="s1">#     [km]    [km]    [m]     [m]      [m]</span>
<span class="s1">#-------------------------------------------------------------------------------</span>
<span class="si">%(patches_str)s</span><span class="s1"></span>
<span class="s1">#================================end of input===================================</span>
<span class="s1">&#39;&#39;&#39;</span>  <span class="c1"># noqa</span>
        <span class="k">return</span> <span class="n">template</span> <span class="o">%</span> <span class="n">d</span></div>


<span class="k">class</span> <span class="nc">PsCmpError</span><span class="p">(</span><span class="n">gf</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">StoreError</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Interrupted</span><span class="p">(</span><span class="n">gf</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">StoreError</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Interrupted.&#39;</span>


<span class="k">class</span> <span class="nc">PsCmpRunner</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_tmp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span> <span class="o">=</span> <span class="n">mkdtemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;pscmprun-&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="n">tmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_tmp</span> <span class="o">=</span> <span class="n">keep_tmp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">TemporaryFile</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;pscmprun-out-&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">TemporaryFile</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;pscmprun-err-&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>

        <span class="n">input_fn</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">input_str</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">string_for_config</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;===== begin pscmp input =====</span><span class="se">\n</span><span class="s1">&#39;</span>
                     <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">===== end pscmp input =====&#39;</span> <span class="o">%</span> <span class="n">input_str</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">input_str</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">program</span> <span class="o">=</span> <span class="n">program_bins</span><span class="p">[</span><span class="s1">&#39;pscmp.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">pscmp_version</span><span class="p">]</span>

        <span class="n">old_wd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">)</span>

        <span class="n">interrupted</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">signal_handler</span><span class="p">(</span><span class="n">signum</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">)</span>
            <span class="n">interrupted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">original</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal_handler</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">proc</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span>
                    <span class="n">program</span><span class="p">,</span>
                    <span class="n">stdin</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
                    <span class="n">close_fds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">old_wd</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;OS error: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">PsCmpError</span><span class="p">(</span><span class="s1">&#39;could not start pscmp: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">program</span><span class="p">)</span>

            <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="s1">&#39;input</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">original</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">interrupted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;===== begin pscmp output =====</span><span class="se">\n</span><span class="s1">&#39;</span>
                     <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">===== end pscmp output =====&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

        <span class="n">error_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">output_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">errmess</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">errmess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s1">&#39;pscmp had a non-zero exit state: </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">error_str</span><span class="p">:</span>
            <span class="n">errmess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;pscmp emitted something via stderr&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">errmess</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;the string &#39;error&#39; appeared in pscmp output&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">errmess</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keep_tmp</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">old_wd</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">PsCmpError</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">===== begin pscmp input =====</span>
<span class="si">%s</span><span class="s1">===== end pscmp input =====</span>
<span class="s1">===== begin pscmp output =====</span>
<span class="si">%s</span><span class="s1">===== end pscmp output =====</span>
<span class="s1">===== begin pscmp error =====</span>
<span class="si">%s</span><span class="s1">===== end pscmp error =====</span>
<span class="si">%s</span><span class="s1"></span>
<span class="s1">pscmp has been invoked as &quot;</span><span class="si">%s</span><span class="s1">&quot;</span>
<span class="s1">in the directory </span><span class="si">%s</span><span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">input_str</span><span class="p">,</span> <span class="n">output_str</span><span class="p">,</span> <span class="n">error_str</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">errmess</span><span class="p">),</span> <span class="n">program</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pscmp_output</span> <span class="o">=</span> <span class="n">output_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pscmp_error</span> <span class="o">=</span> <span class="n">error_str</span>

        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">old_wd</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="s1">&#39;displ&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;snapshot&#39;</span><span class="p">,</span> <span class="n">flip_z</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Be careful: The z-component is downward positive!</span>
<span class="sd">        If flip_z=True it will be flipped upward! For displacements!</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s1">&#39;snapshot&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">times_snapshots</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">fns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_output_filenames</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;get_results: which argument should be &quot;snapshot&quot;&#39;</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">num</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
            <span class="n">nsamples</span><span class="p">,</span> <span class="n">n_comp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>

            <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="s1">&#39;displ&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">flip_z</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="s1">&#39;stress&#39;</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">:</span><span class="mi">11</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="s1">&#39;tilt&#39;</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">11</span><span class="p">:</span><span class="mi">14</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="s1">&#39;gravity&#39;</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">14</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
       <span class="s1">&#39;get_results: component argument should be &quot;displ/stress/tilt/gravity&quot;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_tmp</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s1">&#39;not removing temporary directory: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">tempdir</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
    <a id="sidebar-anchor"></a>
    
<h3><a href="../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../short_installation.html">Short Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Detailed Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../updating.html">Updating beat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started with BEAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
    &nbsp;
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Hannes Vasyura-Bathke.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
    </div>
  </body>
</html>